# 01.3 CI/CDå¤±è´¥è‡ªæ„ˆæœºåˆ¶ï¼šCopilotä¸è‡ªåŠ¨åŒ–è„šæœ¬çš„æ•‘åœºå®å½•

**ä½œè€…**: Cline | **å‘å¸ƒæ—¥æœŸ**: 2025-10-24 | **åˆ†ç±»**: `æ ¸å¿ƒæŠ€æœ¯æ ˆ` `CI/CD` `DevOps` `GitHub`

**æ‘˜è¦**: å‘¨äº”ä¸‹åˆäº”ç‚¹çš„éƒ¨ç½²å¤±è´¥ï¼Œæ˜¯æ¯ä¸ªå·¥ç¨‹å¸ˆçš„å™©æ¢¦ã€‚ä½†å¦‚æœä½ çš„CI/CDæµæ°´çº¿èƒ½åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„è€å…µï¼Œåœ¨å‘ç°é—®é¢˜æ—¶è‡ªåŠ¨å›æ»šã€å‘å‡ºè­¦æŠ¥ï¼Œå¹¶â€œè‡ªæ„ˆâ€åˆ°ç¨³å®šçŠ¶æ€å‘¢ï¼Ÿæœ¬ç¯‡æ•™ç¨‹å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„â€œæ•‘åœºå®å½•â€ï¼Œå‘æ‚¨å±•ç¤ºå¦‚ä½•æ„å»ºä¸€å¥—å…·å¤‡â€œè‡ªæ„ˆâ€èƒ½åŠ›çš„CI/CDå·¥ä½œæµã€‚æˆ‘ä»¬å°†ä½¿ç”¨GitHub Actionsä½œä¸ºæ¡†æ¶ï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨GitHub Copilotä½œä¸ºæ™ºèƒ½å‰¯é©¾é©¶ï¼Œå¿«é€Ÿç¼–å†™å‡ºæ ¸å¿ƒçš„å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨å›æ»šè„šæœ¬ï¼Œè®©ä½ çš„éƒ¨ç½²æµç¨‹ä»æ­¤å‘Šåˆ«â€œå¿ƒæƒŠèƒ†æˆ˜â€ã€‚

**SEOå…³é”®è¯**: CI/CD, è‡ªæ„ˆç³»ç»Ÿ, è‡ªåŠ¨å›æ»š, GitHub Actions, GitHub Copilot, DevOps, è“ç»¿éƒ¨ç½², é‡‘ä¸é›€å‘å¸ƒ, å¥åº·æ£€æŸ¥

---

## åºç« ï¼šå‘¨äº”ä¸‹åˆçš„â€œçº¢è‰²è­¦æŠ¥â€

æ•…äº‹å‘ç”Ÿåœ¨ä¸€ä¸ªå¯»å¸¸çš„å‘¨äº”ä¸‹åˆã€‚ä¸€ä¸ªç´§æ€¥çš„Bugä¿®å¤éœ€æ±‚åˆå…¥äº†ä¸»åˆ†æ”¯ï¼ŒCI/CDæµæ°´çº¿è‡ªåŠ¨è§¦å‘ã€‚ç»¿è‰²çš„å¯¹å‹¾ä¸€è·¯äº®èµ·ï¼šä»£ç æ„å»ºæˆåŠŸã€å•å…ƒæµ‹è¯•é€šè¿‡ã€Dockeré•œåƒæ¨é€æˆåŠŸâ€¦â€¦ç›´åˆ°æœ€åçš„â€œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒâ€é˜¶æ®µï¼Œå›¾æ ‡æ— æƒ…åœ°å˜æˆäº†çº¢è‰²ã€‚ä¸æ­¤åŒæ—¶ï¼ŒSlacké¢‘é“é‡Œè­¦æŠ¥å“èµ·ï¼Œä½†å†…å®¹å´ä¸æ˜¯â€œéƒ¨ç½²å¤±è´¥ï¼Œè¯·æ±‚æ”¯æ´ï¼â€ï¼Œè€Œæ˜¯ï¼šâ€œ**è­¦å‘Šï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤±è´¥ï¼Œå·²è‡ªåŠ¨å›æ»šè‡³ä¸Šä¸€ç¨³å®šç‰ˆæœ¬ã€‚ç³»ç»Ÿç›®å‰è¿è¡Œæ­£å¸¸ï¼Œè¯·ç›¸å…³äººå‘˜åœ¨å‘¨ä¸€æ’æŸ¥é—®é¢˜ã€‚**â€

æ²¡æœ‰ç”µè¯ä¼šè®®ï¼Œæ²¡æœ‰æ‰‹å¿™è„šä¹±çš„æ•‘ç«ï¼Œæ›´æ²¡æœ‰ä¸€ä¸ªè¢«æ¯æ‰çš„å‘¨æœ«ã€‚è¿™ä¸€åˆ‡ï¼Œéƒ½å¾—ç›Šäºæˆ‘ä»¬é¢„å…ˆæ„å»ºçš„â€œè‡ªæ„ˆâ€æœºåˆ¶ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å¤ç›˜å¹¶ä»é›¶å¼€å§‹æ„å»ºè¿™å¥—ç³»ç»Ÿã€‚

---

## ç¬¬1éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆCI/CDä¼šå¤±è´¥ï¼Ÿæ•…éšœå‰–æ

ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„éƒ¨ç½²æµç¨‹ï¼Œå®é™…ä¸Šå……æ»¡äº†æ½œåœ¨çš„æ•…éšœç‚¹ã€‚ç†è§£å®ƒä»¬æ˜¯æ„å»ºè‡ªæ„ˆç³»ç»Ÿçš„å‰æã€‚

- **æ„å»ºé˜¶æ®µå¤±è´¥ (Build Failures)**
    - **ä¾èµ–é—®é¢˜**: `npm`æˆ–`pip`çš„æŸä¸ªä¸Šæ¸¸åŒ…è¢«åˆ é™¤æˆ–å‘å¸ƒäº†ä¸å…¼å®¹çš„ç‰ˆæœ¬ï¼›ç§æœ‰ä»“åº“ç½‘ç»œä¸é€šã€‚
    - **ç¼–è¯‘é”™è¯¯**: ä»£ç åœ¨æœ¬åœ°èƒ½è·‘ï¼Œä½†åœ¨CIç¯å¢ƒä¸­å› ç¯å¢ƒå·®å¼‚ï¼ˆå¦‚Node.jsç‰ˆæœ¬ã€ç³»ç»Ÿåº“ç¼ºå¤±ï¼‰è€Œç¼–è¯‘å¤±è´¥ã€‚
    - **æµ‹è¯•å¤±è´¥ (Flaky Tests)**: ä¸ç¨³å®šçš„â€œéšæœºæ€§â€æµ‹è¯•ç”¨ä¾‹ï¼Œæ—¶è€Œé€šè¿‡æ—¶è€Œå¤±è´¥ï¼Œæ˜¯CI/CDçš„ä¸»è¦æ•Œäººä¹‹ä¸€ã€‚

- **éƒ¨ç½²é˜¶æ®µå¤±è´¥ (Deployment Failures)**
    - **åŸºç¡€è®¾æ–½é—®é¢˜**: ç›®æ ‡æœåŠ¡å™¨å®•æœºã€ç£ç›˜ç©ºé—´å·²æ»¡ã€ç½‘ç»œä¸é€šã€‚
    - **é…ç½®æ¼‚ç§» (Configuration Drift)**: ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é˜²ç«å¢™è§„åˆ™ï¼‰ä¸æµ‹è¯•ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´åº”ç”¨æ— æ³•å¯åŠ¨ã€‚
    - **æ•°æ®åº“è¿ç§»å¤±è´¥**: æ–°ç‰ˆæœ¬çš„æ•°æ®åº“è¿ç§»è„šæœ¬å­˜åœ¨Bugï¼Œæ‰§è¡Œå¤±è´¥å¹¶å¯¼è‡´éƒ¨ç½²ä¸­æ–­ã€‚
    - **æƒé™ä¸è¶³**: éƒ¨ç½²è„šæœ¬æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥è¯»å†™æ–‡ä»¶ã€é‡å¯æœåŠ¡æˆ–æ“ä½œDockerã€‚

- **è¿è¡Œæ—¶å¤±è´¥ (Post-Deployment Failures)**
    - **æœ€å±é™©çš„å¤±è´¥ç±»å‹**: éƒ¨ç½²æµç¨‹æ˜¾ç¤ºâ€œæˆåŠŸâ€ï¼Œä½†åº”ç”¨åœ¨å¯åŠ¨åå‡ ç§’æˆ–å‡ åˆ†é’Ÿå†…ï¼Œå› ä¸€ä¸ªéšè—çš„Bugï¼ˆå¦‚ç©ºæŒ‡é’ˆã€å†…å­˜æ³„æ¼ã€é”™è¯¯çš„ç‰¹æ€§æ ‡å¿—ï¼‰è€Œå´©æºƒæˆ–æŒç»­è¿”å›500é”™è¯¯ã€‚

æˆ‘ä»¬çš„â€œè‡ªæ„ˆâ€æœºåˆ¶ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†åº”å¯¹**éƒ¨ç½²é˜¶æ®µ**å’Œ**è¿è¡Œæ—¶**çš„å¤±è´¥ã€‚

---

## ç¬¬2éƒ¨åˆ†ï¼šâ€œè‡ªæ„ˆâ€çš„æ ¸å¿ƒç†å¿µ

è‡ªæ„ˆç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä¸æ˜¯è¿½æ±‚æ°¸ä¸å¤±è´¥ï¼Œè€Œæ˜¯åœ¨å¤±è´¥å‘ç”Ÿæ—¶ï¼Œèƒ½**å¿«é€Ÿã€è‡ªåŠ¨ã€å¯é¢„æµ‹**åœ°æ¢å¤æœåŠ¡ã€‚

- **å¿«é€Ÿ (Speed)**: ç³»ç»Ÿå¿…é¡»åœ¨å‡ åˆ†é’Ÿå†…ï¼Œè€Œä¸æ˜¯å‡ å°æ—¶å†…ï¼Œæ£€æµ‹åˆ°æ•…éšœå¹¶å®Œæˆæ¢å¤åŠ¨ä½œã€‚
- **è‡ªåŠ¨ (Automation)**: æ•´ä¸ªå›æ»šå’Œæ¢å¤è¿‡ç¨‹åº”å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€ä»»ä½•äººå·¥å¹²é¢„ã€‚äººçš„èŒè´£æ˜¯äº‹åè¿›è¡Œå¤ç›˜å’Œæ ¹æºåˆ†æï¼Œè€Œä¸æ˜¯åœ¨æ·±å¤œè¢«å«èµ·æ¥â€œæ•‘ç«â€ã€‚
- **å¯é¢„æµ‹ (Predictability)**: å›æ»šæµç¨‹å¿…é¡»æå…¶å¯é ï¼Œç¡®ä¿æ€»èƒ½å°†ç³»ç»Ÿæ¢å¤åˆ°ä¸€ä¸ªå·²çŸ¥çš„ã€ç¨³å®šçš„çŠ¶æ€ã€‚

**è‡ªæ„ˆç³»ç»Ÿçš„ä¸‰å¤§æ”¯æŸ±**:
1.  **å¯é çš„å¥åº·æ£€æŸ¥ (Health Checks)**: ä¸€ä¸ªèƒ½å‡†ç¡®åæ˜ åº”ç”¨æ˜¯å¦â€œå¥åº·â€çš„æœºåˆ¶ã€‚
2.  **è‡ªåŠ¨åŒ–çš„å›æ»š (Automated Rollback)**: ä¸€å¥—è„šæœ¬åŒ–çš„ã€èƒ½å°†ç³»ç»Ÿæ¢å¤åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬çš„æµç¨‹ã€‚
3.  **æ™ºèƒ½çš„é€šçŸ¥ (Smart Notifications)**: åœ¨ç³»ç»Ÿ**å®Œæˆè‡ªæ„ˆå**ï¼Œå†é€šçŸ¥ç›¸å…³äººå‘˜ï¼Œæä¾›æ¸…æ™°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œä¸æ˜¯åœ¨é—®é¢˜å‘ç”Ÿæ—¶å°±å‘å‡ºææ…Œæ€§è­¦æŠ¥ã€‚

---

## ç¬¬3éƒ¨åˆ†ï¼šå®æˆ˜ï¼šæ„å»ºå¸¦è‡ªæ„ˆåŠŸèƒ½çš„GitHub Actionså·¥ä½œæµ

**åœºæ™¯**: æˆ‘ä»¬æœ‰ä¸€ä¸ªNode.jsåº”ç”¨ï¼Œé€šè¿‡Dockerè¿›è¡Œéƒ¨ç½²ï¼Œç›®æ ‡æœåŠ¡å™¨æ˜¯ä¸€å°DigitalOcean Dropletã€‚

### 3.1 `deploy.yml` å·¥ä½œæµæ–‡ä»¶

åœ¨ä½ çš„é¡¹ç›®`.github/workflows/`ç›®å½•ä¸‹åˆ›å»º`deploy.yml`ã€‚

```yaml
name: Deploy to Production with Self-Healing

on:
  push:
    branches:
      - main

jobs:
  # --- ä½œä¸š1: æ„å»ºå¹¶æ¨é€Dockeré•œåƒ ---
  build_and_push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and push Docker image
        id: docker_build
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: your-docker-repo/my-app:${{ github.sha }}

  # --- ä½œä¸š2: éƒ¨ç½²å¹¶ç›‘æ§ (æ ¸å¿ƒ) ---
  deploy_and_monitor:
    needs: build_and_push
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to server and monitor health
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.PROD_SERVER_HOST }}
          username: ${{ secrets.PROD_SERVER_USERNAME }}
          key: ${{ secrets.PROD_SERVER_SSH_KEY }}
          script: |
            # è„šæœ¬å°†åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
            set -e # ä»»ä½•å‘½ä»¤å¤±è´¥åˆ™ç«‹å³é€€å‡º

            # å®šä¹‰å˜é‡
            IMAGE_NAME="your-docker-repo/my-app:${{ github.sha }}"
            NEW_CONTAINER_NAME="my-app-${{ github.sha }}"
            APP_PORT=3000

            echo "--- 1. æ‹‰å–æ–°é•œåƒ ---"
            docker pull $IMAGE_NAME

            echo "--- 2. æŸ¥æ‰¾å½“å‰è¿è¡Œçš„å®¹å™¨ (ç”¨äºå›æ»š) ---"
            # é€šè¿‡æ ‡ç­¾æ‰¾åˆ°å½“å‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨å®¹å™¨
            CURRENT_CONTAINER_ID=$(docker ps -q --filter "label=app=my-app")
            if [ -z "$CURRENT_CONTAINER_ID" ]; then
              echo "No currently running container found. Proceeding with new deployment."
              CURRENT_CONTAINER_ID=""
            else
              echo "Found running container: $CURRENT_CONTAINER_ID"
            fi

            echo "--- 3. å¯åŠ¨æ–°ç‰ˆæœ¬å®¹å™¨ ---"
            docker run -d --rm -p $APP_PORT:$APP_PORT --name $NEW_CONTAINER_NAME -l app=my-app $IMAGE_NAME
            sleep 10 # ç­‰å¾…å®¹å™¨å¯åŠ¨

            echo "--- 4. æ‰§è¡Œå¥åº·æ£€æŸ¥ (è‡ªæ„ˆæ ¸å¿ƒ) ---"
            HEALTHY=false
            for i in {1..10}; do
              # å‡è®¾åº”ç”¨åœ¨/healthzç«¯ç‚¹è¿”å›200
              if curl -f http://localhost:$APP_PORT/healthz; then
                echo "Health check passed!"
                HEALTHY=true
                break
              fi
              echo "Health check attempt $i failed. Retrying in 10 seconds..."
              sleep 10
            done

            # --- 5. æ ¹æ®å¥åº·æ£€æŸ¥ç»“æœæ‰§è¡Œæ“ä½œ ---
            if [ "$HEALTHY" = "true" ]; then
              echo "âœ… Deployment successful!"
              # åœæ­¢å¹¶ç§»é™¤æ—§å®¹å™¨
              if [ -n "$CURRENT_CONTAINER_ID" ]; then
                echo "Stopping old container: $CURRENT_CONTAINER_ID"
                docker stop $CURRENT_CONTAINER_ID
              fi
              exit 0
            else
              echo "âŒ Health checks failed after multiple attempts! Initiating rollback..."
              # åœæ­¢å¹¶ç§»é™¤å¤±è´¥çš„æ–°å®¹å™¨
              docker stop $NEW_CONTAINER_NAME
              # ç¡®ä¿æ—§å®¹å™¨ä»åœ¨è¿è¡Œ (å¦‚æœå®ƒå› ä¸ºæŸäº›åŸå› åœäº†ï¼Œå°±é‡å¯å®ƒ)
              if [ -n "$CURRENT_CONTAINER_ID" ] && [ -z "$(docker ps -q -f id=$CURRENT_CONTAINER_ID)" ]; then
                 echo "Old container was stopped. Restarting it..."
                 docker start $CURRENT_CONTAINER_ID
              fi
              echo " Rollback complete. System is running on the previous stable version."
              exit 1 # é€€å‡ºå¹¶æ ‡è®°GitHub Actionå¤±è´¥
            fi

  # --- ä½œä¸š3: éƒ¨ç½²å¤±è´¥æ—¶å‘é€é€šçŸ¥ ---
  notify_on_failure:
    needs: deploy_and_monitor
    if: failure() # åªæœ‰å½“ä¸Šä¸€ä¸ªä½œä¸šå¤±è´¥æ—¶æ‰è¿è¡Œ
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack notification
        uses: slackapi/slack-github-action@v1.24.0
        with:
          payload: |
            {
              "text": "ğŸš¨ Production Deployment Failed! ğŸš¨",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*CI/CD pipeline failed during deployment but has been automatically rolled back to the previous stable version. *\n\n*No immediate action is required, but please investigate the root cause on Monday."
                  }
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "mrkdwn",
                      "text": "*Commit:* `${{ github.event.head_commit.message }}` by *${{ github.actor }}*"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Action URL:* <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}>"
                    }
                  ]
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

---

## ç¬¬4éƒ¨åˆ†ï¼šCopilotçš„è§’è‰²ï¼šAIè¾…åŠ©ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬

ä¸Šè¿°å·¥ä½œæµä¸­çš„æ ¸å¿ƒâ€”â€”éƒ¨ç½²ä¸å¥åº·æ£€æŸ¥è„šæœ¬ï¼Œå®Œå…¨å¯ä»¥å€ŸåŠ©GitHub Copilotæ¥å¿«é€Ÿç”Ÿæˆã€‚Copilotåœ¨è¿™ç§â€œé€»è¾‘æ˜ç¡®ã€ä½†è¯­æ³•ç¹çâ€çš„è„šæœ¬ç¼–å†™åœºæ™¯ä¸­ï¼Œè¡¨ç°å¾—åƒä¸€ä¸ªç»éªŒä¸°å¯Œçš„DevOpså·¥ç¨‹å¸ˆã€‚

**â€œæ•‘åœºå®å½•â€ï¼šæˆ‘æ˜¯å¦‚ä½•ä¸Copilotåä½œçš„**

1.  **ç¼–å†™â€œæ„å›¾æ³¨é‡Šâ€**: æˆ‘åœ¨ä¸€ä¸ªç©ºçš„`health_check.sh`æ–‡ä»¶ä¸­ï¼Œé¦–å…ˆç”¨æ³¨é‡Šå†™ä¸‹æˆ‘çš„å®Œæ•´æ„å›¾ã€‚

    ```bash
    # This script performs a health check on a newly deployed Docker container.
    # It takes a container's exposed port as àª²à«‹àª•à«‹ument 1.
    # It should curl a /healthz endpoint on localhost at the given port.
    # It should loop for a total of 2 minutes.
    # Inside the loop, it should try to connect every 10 seconds.
    # If it gets a 200 OK response 3 times in a row, it should print "Health check successful!" and exit with code 0.
    # If the 2 minutes pass without 3 successful checks, it should print "Health check failed!" and exit with code 1.
    ```

2.  **Copilotç”Ÿæˆåˆç¨¿**: åœ¨æˆ‘å†™å®Œæ³¨é‡Šåï¼ŒCopilotå‡ ä¹ç¬é—´å°±ç”Ÿæˆäº†ä¸€ä¸ªåŒ…å«`for`å¾ªç¯ã€`curl`å’Œ`sleep`çš„å®Œæ•´è„šæœ¬æ¡†æ¶ã€‚

3.  **å¯¹è¯å¼ä¼˜åŒ–**: ç”Ÿæˆçš„åˆç¨¿é€»è¾‘åŸºæœ¬æ­£ç¡®ï¼Œä½†æˆ‘å¸Œæœ›å®ƒæ›´å¥å£®ã€‚æˆ‘ç»§ç»­é€šè¿‡æ³¨é‡Šæˆ–åœ¨Copilot Chatä¸­æå‡ºè¦æ±‚ï¼š
    - æˆ‘: `// add colorized output for success and failure messages` -> Copilotä¸ºæˆ‘æ·»åŠ äº†`GREEN='[0;32m'`ç­‰é¢œè‰²å˜é‡å’Œ`echo -e`ã€‚
    - æˆ‘: `// what if the curl command hangs? add a timeout` -> Copilotä¸º`curl`å‘½ä»¤æ·»åŠ äº†`--max-time 5`å‚æ•°ã€‚
    - æˆ‘: `// how to count consecutive successes?` -> Copilotå¼•å…¥äº†ä¸€ä¸ª`SUCCESS_COUNT`å˜é‡ï¼Œå¹¶åœ¨å¾ªç¯ä¸­è¿›è¡Œåˆ¤æ–­ã€‚

4.  **ç”Ÿæˆé€šçŸ¥Payload**: å¯¹äºSlacké€šçŸ¥ï¼Œæˆ‘åªéœ€å‘Šè¯‰Copilotï¼š`// Write a JSON payload for a Slack webhook. It should have a main title "Production Deployment Failed!", a descriptive text, and a context block with the commit message and a link to the GitHub Action run.` Copilotç«‹åˆ»å°±ç”Ÿæˆäº†`deploy.yml`ä¸­ä½¿ç”¨çš„ã€ç»“æ„å®Œå…¨æ­£ç¡®çš„JSONã€‚

**ç»“è®º**: åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ‰®æ¼”çš„æ˜¯â€œæ¶æ„å¸ˆâ€å’Œâ€œäº§å“ç»ç†â€çš„è§’è‰²ï¼Œè´Ÿè´£å®šä¹‰éœ€æ±‚å’Œé€»è¾‘ï¼›è€ŒCopilotåˆ™æ‰®æ¼”äº†â€œé«˜æ•ˆçš„ç¨‹åºå‘˜â€ï¼Œè´Ÿè´£å°†æˆ‘çš„é€»è¾‘ç¿»è¯‘æˆå…·ä½“ã€æ— è¯¯çš„ä»£ç ã€‚è¿™æå¤§åœ°åŠ é€Ÿäº†æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹çš„å¼€å‘ã€‚

---

## ç¬¬5éƒ¨åˆ†ï¼šè¶…è¶ŠåŸºç¡€ï¼šè“ç»¿éƒ¨ç½²ä¸é‡‘ä¸é›€å‘å¸ƒ

æˆ‘ä»¬çš„è‡ªåŠ¨å›æ»šè„šæœ¬æ˜¯ä¸€ç§æœ‰æ•ˆçš„â€œååº”å¼â€è‡ªæ„ˆã€‚è€Œæ›´é«˜çº§çš„éƒ¨ç½²ç­–ç•¥ï¼Œåˆ™èƒ½æä¾›â€œä¸»åŠ¨å¼â€çš„é£é™©æ§åˆ¶ï¼Œå°†å¤±è´¥çš„å½±å“èŒƒå›´é™è‡³æœ€ä½ã€‚

- **è“ç»¿éƒ¨ç½² (Blue/Green Deployment)**
    - **åŸç†**: åŒæ—¶ç»´æŠ¤ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ã€ç‹¬ç«‹çš„ç”Ÿäº§ç¯å¢ƒï¼ˆè“/ç»¿ï¼‰ã€‚å‡è®¾å½“å‰çº¿ä¸Šæ˜¯è“è‰²ç¯å¢ƒï¼Œæ–°ç‰ˆæœ¬å°†éƒ¨ç½²åˆ°é—²ç½®çš„ç»¿è‰²ç¯å¢ƒã€‚åœ¨ç»¿è‰²ç¯å¢ƒä¸Šå®Œæˆæ‰€æœ‰æµ‹è¯•å’Œå¥åº·æ£€æŸ¥åï¼Œåªéœ€åœ¨è´Ÿè½½å‡è¡¡å™¨æˆ–DNSå±‚é¢ï¼Œå°†æ‰€æœ‰å®æ—¶æµé‡ä»è“è‰²åˆ‡æ¢åˆ°ç»¿è‰²ã€‚æ—§çš„è“è‰²ç¯å¢ƒä½œä¸ºçƒ­å¤‡ä»½ï¼Œä¸€æ—¦æ–°ç‰ˆå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å†æ¬¡åˆ‡æ¢å›å»ï¼Œå®ç°ç§’çº§å›æ»šã€‚

- **é‡‘ä¸é›€å‘å¸ƒ (Canary Release)**
    - **åŸç†**: å°†æ–°ç‰ˆæœ¬å…ˆå‘å¸ƒç»™ä¸€å°éƒ¨åˆ†ç”¨æˆ·ï¼ˆä¾‹å¦‚1%çš„ç”¨æˆ·ï¼Œå°±åƒçŸ¿äº•é‡Œçš„é‡‘ä¸é›€ä¸€æ ·ï¼Œç”¨äºæ¢è·¯ï¼‰ã€‚é€šè¿‡ç›‘æ§è¿™éƒ¨åˆ†ç”¨æˆ·çš„é”™è¯¯ç‡ã€æ€§èƒ½æŒ‡æ ‡å’Œä¸šåŠ¡æŒ‡æ ‡ï¼Œæ¥åˆ¤æ–­æ–°ç‰ˆæœ¬æ˜¯å¦ç¨³å®šã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™é€æ­¥æ‰©å¤§æ–°ç‰ˆæœ¬çš„æµé‡æ¯”ä¾‹ï¼ˆ1% -> 10% -> 50% -> 100%ï¼‰ï¼Œç›´åˆ°å®Œå…¨æ›¿ä»£æ—§ç‰ˆæœ¬ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œç«‹å³å°†æ‰€æœ‰æµé‡åˆ‡å›æ—§ç‰ˆæœ¬ã€‚

è¿™äº›é«˜çº§ç­–ç•¥é€šå¸¸éœ€è¦æ›´å¤æ‚çš„åŸºç¡€è®¾æ–½æ”¯æŒï¼ˆå¦‚æœåŠ¡ç½‘æ ¼Istio, Linkerdï¼‰ï¼Œä½†å®ƒä»¬ä»£è¡¨äº†CI/CDè‡ªæ„ˆèƒ½åŠ›çš„ç»ˆæå½¢æ€ã€‚

## ç»“è®º

CI/CDæµæ°´çº¿ä¸åº”ä»…ä»…æ˜¯ä¸€ä¸ªâ€œä¸€æ¨äº†ä¹‹â€çš„æ‰§è¡Œå™¨ï¼Œå®ƒæ›´åº”è¯¥æ˜¯ä¸€ä¸ªå…·å¤‡é£é™©æ„è¯†çš„â€œæ™ºèƒ½è°ƒåº¦ç³»ç»Ÿâ€ã€‚é€šè¿‡åœ¨éƒ¨ç½²æµç¨‹ä¸­å†…ç½®è‡ªåŠ¨åŒ–çš„å¥åº·æ£€æŸ¥å’Œå›æ»šæœºåˆ¶ï¼Œä½ å¯ä»¥å°†éƒ¨ç½²ä»ä¸€ç§é«˜å‹ã€é«˜é£é™©çš„æ´»åŠ¨ï¼Œè½¬å˜ä¸ºä¸€ç§å¯é ã€å¯é¢„æµ‹çš„å¸¸è§„æ“ä½œã€‚GitHub Actionsç­‰ç°ä»£CI/CDå·¥å…·æä¾›äº†å¼ºå¤§çš„æ¡†æ¶ï¼Œè€ŒCopilotç­‰AIåŠ©æ‰‹åˆ™èƒ½å¸®ä½ å¿«é€Ÿç”Ÿæˆå®ç°è¿™äº›é€»è¾‘æ‰€éœ€çš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚æ‹¥æŠ±è‡ªæ„ˆï¼Œä½ å°†èƒ½æ›´è‡ªä¿¡åœ°å‘å¸ƒï¼Œæ›´å®‰ç¨³åœ°ç¡çœ ã€‚

## å‚è€ƒèµ„æ–™

1.  [GitHub Actions Documentation](https://docs.github.com/en/actions)
2.  [appleboy/ssh-action on GitHub Marketplace](https://github.com/marketplace/actions/ssh-remote-commands)
3.  [slackapi/slack-github-action on GitHub Marketplace](https://github.com/marketplace/actions/slack-send)
4.  [Martin Fowler - BlueGreenDeployment](https://martinfowler.com/bliki/BlueGreenDeployment.html)
5.  [Martin Fowler - CanaryRelease](https://martinfowler.com/bliki/CanaryRelease.html)
