# Notion AI + Slack Bot打造知识管理系统

**作者**: Cline | **发布日期**: 2025-11-09 | **分类**: `AI工具链` `自动化` `Notion` `Slack` `Serverless`

**摘要**: 在现代团队协作中，知识被零散地存放在各种SaaS工具里：技术文档在Notion，日常讨论在Slack，代码在GitHub。如何将这些孤立的知识孤岛连接起来，并注入AI的智慧，打造一个随叫随到的团队“第二大脑”？本文将提供一份终极解决方案。我们将从零开始，一步步教你如何构建一个基于Serverless架构的智能知识管理机器人。这个机器人能够：1) 在Slack中通过斜杠命令被唤醒；2) 自动查询Notion数据库中的技术文档和会议纪要；3) 调用大型语言模型（如Claude）对检索到的内容进行总结或回答；4) 将精炼后的答案实时发送回Slack频道。跟随本教程，你将掌握连接Notion、Slack和AI的强大能力，为你的团队构建一个真正智能、高效的知识中枢。

**SEO关键词**: Notion AI, Slack Bot, 知识管理自动化, Serverless, Vercel Functions, Notion API, Slack API, AI机器人

---

## 第1部分：系统蓝图：构建智能知识流动的“神经系统”

我们的目标是创建一个无缝的工作流，让团队成员可以在Slack中直接查询存储在Notion中的知识。

**核心组件**:
1.  **Notion Database**: 我们的“知识大脑”。我们将创建一个数据库，用于存放所有的技术文档、会议纪要和FAQ。
2.  **Slack App (Bot)**: 我们的“交互界面”。团队成员通过在Slack中调用一个自定义的斜杠命令（如`/ask`）来与系统交互。
3.  **Serverless Function**: 我们的“神经中枢”。这是一个托管在Vercel或Netlify等平台上的轻量级Node.js函数。它负责接收来自Slack的请求，调用Notion API和AI模型，然后将结果返回给Slack。
4.  **AI模型 (Claude/ChatGPT)**: 我们的“分析与总结引擎”。负责理解用户问题，并对从Notion检索到的信息进行智能处理。

**工作流程**:
`Slack User` -> `/ask "问题"` -> `Slack API` -> `Serverless Function` -> `Notion API (搜索)` -> `AI Model (总结)` -> `Serverless Function` -> `Slack API (回复)` -> `Slack Channel`

---

## 第2部分：准备工作：配置你的SaaS工具

在编写代码之前，我们需要获取所有服务的API访问权限。

### 2.1 Notion端配置

1.  **创建知识库**: 在Notion中，创建一个新的数据库。为它添加`Title`, `Content`, `Tags`, `Created Date`等属性。
2.  **创建集成 (Integration)**:
    -   访问 [notion.so/my-integrations](https://www.notion.so/my-integrations) 并创建一个新的集成。
    -   给它命名，例如“SlackKnowledgeBot”。
    -   复制并保存生成的**Internal Integration Token**。这是你的`NOTION_API_KEY`。
    -   回到你的Notion数据库页面，点击右上角的“...”，选择“Add connections”，然后将你刚刚创建的集成连接到这个数据库。
3.  **获取数据库ID**:
    -   你的Notion数据库URL格式为 `https://www.notion.so/your-workspace/DATABASE_ID?v=...`。
    -   复制那段32个字符的`DATABASE_ID`。

### 2.2 Slack端配置

1.  **创建Slack App**:
    -   访问 [api.slack.com/apps](https://api.slack.com/apps) 并创建一个新的App。
    -   选择“From scratch”，为App命名，并选择你的工作区。
2.  **配置斜杠命令**:
    -   在左侧菜单中，选择`Features` -> `Slash Commands`。
    -   创建一个新命令，例如:
        -   **Command**: `/ask`
        -   **Request URL**: 我们稍后会填入Serverless函数的URL。暂时留空或填写一个占位符。
        -   **Short Description**: `Ask a question to our Notion knowledge base.`
3.  **获取App凭证**:
    -   在`Settings` -> `Basic Information`中，找到并保存**Signing Secret**。这是`SLACK_SIGNING_SECRET`。
    -   在`Features` -> `OAuth & Permissions`中，为你的Bot Token添加必要的权限范围（Scopes）：`commands` (用于斜杠命令) 和 `chat:write` (用于在频道中发消息)。
    -   点击页面顶部的“Install to Workspace”安装应用。
    -   安装后，复制生成的**Bot User OAuth Token**。这是`SLACK_BOT_TOKEN`。

### 2.3 AI模型API密钥

访问OpenAI或Anthropic的平台，获取你的`CLAUDE_API_KEY`或`OPENAI_API_KEY`。

---

## 第3部分：核心中枢：编写Serverless函数

我们将使用Vercel作为Serverless平台，因为它对Node.js支持良好且有慷慨的免费额度。

**项目结构**:
```
notion-slack-bot/
├── api/
│   └── slack.js  (我们的Serverless函数)
├── package.json
└── vercel.json
```

**初始化项目**:
```bash
npm init -y
npm install @slack/bolt @notionhq/client @anthropic-ai/sdk express
# @slack/bolt: Slack官方库，极大简化了机器人开发
# @notionhq/client: Notion官方SDK
# @anthropic-ai/sdk: Anthropic官方SDK
```

**`api/slack.js` (核心逻辑)**:
```javascript
const { App, ExpressReceiver } = require('@slack/bolt');
const { Client } = require('@notionhq/client');
const Anthropic = require('@anthropic-ai/sdk');

// --- 初始化 ---
const notion = new Client({ auth: process.env.NOTION_API_KEY });
const anthropic = new Anthropic({ apiKey: process.env.CLAUDE_API_KEY });

const expressReceiver = new ExpressReceiver({
  signingSecret: process.env.SLACK_SIGNING_SECRET,
  processBeforeResponse: true,
});

const app = new App({
  token: process.env.SLACK_BOT_TOKEN,
  receiver: expressReceiver,
});

// --- Slack斜杠命令处理器 ---
app.command('/ask', async ({ command, ack, respond }) => {
  // 1. 立即响应Slack，避免超时
  await ack({ text: `🤔 正在搜索Notion知识库并请教AI，请稍候...` });

  const question = command.text;

  try {
    // 2. 在Notion中搜索相关文档
    const searchResults = await notion.databases.query({
      database_id: process.env.NOTION_DATABASE_ID,
      filter: {
        property: 'Title',
        title: {
          contains: question,
        },
      },
    });

    if (searchResults.results.length === 0) {
      await respond({ text: `很抱歉，在Notion中没有找到与“${question}”直接相关的文档。` });
      return;
    }

    // 3. 提取文档内容作为AI的上下文
    const context = searchResults.results.map(page => {
      const title = page.properties.Title.title[0].plain_text;
      // 注意：这里需要你根据Notion页面内容结构来提取文本
      // 这是一个简化的例子，真实世界可能需要递归遍历block
      const content = "Page content goes here..."; // Placeholder
      return `文档标题: ${title}\n文档内容: ${content}\n---`;
    }).join('\n');

    // 4. 调用AI进行总结或回答
    const aiResponse = await anthropic.messages.create({
      model: "claude-3-sonnet-20240229",
      max_tokens: 500,
      messages: [{
        role: "user",
        content: `基于以下背景信息，请简洁地回答用户的问题。\n\n用户问题: "${question}"\n\n背景信息:\n${context}`
      }]
    });

    const answer = aiResponse.content[0].text;

    // 5. 将AI的答案发送回Slack
    await respond({
      response_type: 'in_channel', // 'in_channel'使回复对所有人可见
      text: `Hey <@${command.user_id}>, a` + `nswer to your question about "${question}":\n\n${answer}`,
    });

  } catch (error) {
    console.error(error);
    await respond({ text: `糟糕，处理你的请求时发生了错误: ${error.message}` });
  }
});


// --- 部署为Serverless函数 ---
const expressApp = expressReceiver.app;
module.exports = expressApp;
```

---

## 第4部分：部署与连接

### 4.1 部署到Vercel

1.  **安装Vercel CLI**: `npm install -g vercel`
2.  **登录**: `vercel login`
3.  **配置环境变量**:
    在Vercel的项目设置中，添加我们之前获取的所有密钥：
    -   `NOTION_API_KEY`
    -   `NOTION_DATABASE_ID`
    -   `SLACK_SIGNING_SECRET`
    -   `SLACK_BOT_TOKEN`
    -   `CLAUDE_API_KEY`
4.  **`vercel.json`**:
    ```json
    {
      "rewrites": [{ "source": "/slack/events", "destination": "/api/slack" }]
    }
    ```
    这个文件告诉Vercel将所有到`/slack/events`的请求都转发给我们的`slack.js`函数。
5.  **部署**: 在项目根目录运行`vercel`。部署成功后，Vercel会给你一个生产URL，例如 `https://your-project.vercel.app`。

### 4.2 更新Slack请求URL

回到你的Slack App配置页面 (`Features` -> `Slash Commands`)，将`/ask`命令的 **Request URL** 更新为你的Vercel部署URL，并加上路径，例如：
`https://your-project.vercel.app/slack/events`

重新安装App到你的工作区以使变更生效。

---

## 第5部分：见证奇迹的时刻

现在，在你的任何Slack频道中，输入：
`/ask "如何配置我们的CI/CD流水线？"`

**你会看到这样的流程**:
1.  Slack立即显示“🤔 正在搜索Notion知识库并请教AI，请稍候...”。
2.  几秒钟后，机器人会发布一条对频道中所有人都可见的消息，其中包含了从Notion中检索并由AI总结的答案。

> Hey @YourName, answer to your question about "如何配置我们的CI/CD流水线？":
>
> 根据我们的内部文档，配置CI/CD流水线主要分为三个步骤：
> 1.  **在`gitlab-ci.yml`文件中定义Stages**: 通常包括`build`, `test`, `deploy`。
> 2.  **构建Docker镜像**: 使用多阶段构建来优化镜像体积。
> 3.  **部署到生产环境**: 通过SSH执行部署脚本，并包含健康检查和自动回滚机制。
> 详细信息请参考文档：《CI/CD最佳实践》。

---

## 结论：知识的流动与增值

通过将Notion, Slack和AI模型这三个强大的工具连接在一起，我们构建的不仅仅是一个聊天机器人，而是一个**智能化的知识管理中枢**。

**核心价值**:
-   **降低知识获取门槛**: 团队成员无需离开他们最常用的沟通工具（Slack），就能获取到深藏在Notion中的知识。
-   **信息降噪与增值**: AI的总结能力将冗长的文档转化为精准、可操作的答案，减少了信息过载。
-   **自动化工作流**: 整个流程是完全自动化的，减少了在不同工具间切换和手动查找信息所浪费的时间。
-   **无限扩展性**: 你可以轻易地为这个机器人添加更多功能，例如创建Notion页面、集成GitHub、甚至执行某些运维操作。

这，就是AI时代下，重新定义团队协作与知识管理的强大范式。
