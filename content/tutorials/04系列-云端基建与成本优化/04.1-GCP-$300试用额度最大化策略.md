# 04.1 GCP $300试用额度最大化策略：白嫖一年云服务器

> Google Cloud Platform (GCP) 为新用户提供了极其慷慨的 $300 免费试用额度（有效期90天）以及一个强大的“始终免费”套餐 (Always Free Tier)。这为开发者提供了一个绝佳的、零成本的沙盒环境，用于学习云技术、测试新想法、托管个人项目。然而，许多人要么未充分利用这笔额度，要么在试用期后收到意外账单。本篇教程将为你提供一套完整的实战策略，教你如何将这$300额度的价值发挥到极致，并在90天后无缝过渡到“永久免费”方案，实现“白嫖”云资源的终极目标。

**学习目标**:
- 掌握GCP免费套餐的两个核心组成部分：$300试用金和“始终免费”层级。
- 学会如何将$300试用金用于“刀刃上”，体验高价值的云服务。
- 深度解析“始终免费”套餐的各项资源，并学会如何组合它们来永久托管小型应用。
- 掌握设置预算和告警的核心技巧，从根源上杜绝“账单惊喜”。
- 能够在试用期结束后，平稳地将服务迁移到免费资源上。

---

## 第1部分：账号注册与额度激活

首先，你需要一个Google账号和一张有效的信用卡（Visa/Mastercard）。信用卡仅用于身份验证，在试用期间不会被收取任何费用，除非你手动升级到付费账号。

**步骤**:
1.  访问 [Google Cloud 免费试用页面](https://cloud.google.com/free)。
2.  使用你的Google账号登录。
3.  选择你的国家/地区，同意服务条款。
4.  填写客户信息，并在“付款方式”部分添加你的信用卡信息。

完成注册后，你的GCP账号将被激活，并自动获得$300的信用额度，有效期为90天。你可以在控制台的“结算”页面看到额度的剩余金额和天数。

**核心概念区分**:
- **$300试用金**: 一个有时限（90天）的资金池，可用于体验GCP上**几乎所有**的服务，包括那些收费高昂的服务。
- **“始终免费”层级**: 一系列**永久免费**的资源配额，只要你的用量不超过限制，就可以一直免费使用，不受90天试用期的影响。

我们的核心策略就是：**在90天内，用$300试用金尽情体验付费服务；同时，将需要长期运行的小项目部署在“始终免费”的资源上。**

---

## 第2部分：“始终免费”套餐深度解析

这是实现“永久白嫖”的基石。以下是开发者最常用到的免费资源配额（截至2025年，具体请以官方文档为准）：

| 服务 (Service) | 免费配额 (每月) | 关键说明 |
| :--- | :--- | :--- |
| **Compute Engine (虚拟机)** | 1个 `e2-micro` 实例 | 仅限美国西部(us-west1)、中部(us-central1)、东部(us-east1)区域。性能较弱，但足以托管博客或小型Web应用。 |
| | 30 GB 标准永久性磁盘 | 硬盘空间。 |
| | 1 GB 网络出站流量 | 从GCP到北美以外地区的流量。到Google服务（如YouTube）或北美区域内的流量通常更多或免费。 |
| **Cloud Storage (对象存储)** | 5 GB-月 标准存储 | 可用于存放网站静态资源、备份文件等。 |
| | 5,000次 A类操作 | 写入、修改操作。 |
| | 50,000次 B类操作 | 读取操作。 |
| **Firestore (NoSQL数据库)** | 1 GiB 存储空间 | 性能强大的文档数据库。 |
| | 50,000次读取/天, 20,000次写入/天 | 对于个人项目或小型应用来说绰绰有余。 |
| **Cloud Functions (无服务器)** | 200万次调用 | 包括后台和HTTP调用。 |
| | 400,000 GB-秒 算力 | 足以运行大量轻量级函数。 |
| **Cloud Run (无服务器容器)** | 200万次请求 | 用于部署无状态容器应用。 |
| | 360,000 GB-秒 算力 | 另一个托管后端服务的绝佳选择。 |
| **Pub/Sub (消息队列)** | 10 GB 消息 | 用于应用解耦和异步通信。 |

**组合玩法**: 你完全可以搭建一个“全免费”的技术栈：
- 使用`e2-micro`虚拟机运行一个Node.js后端或作为SSH堡垒机。
- 将你的前端应用（如React, Vue）构建为静态文件，存放在Cloud Storage中，并配置为静态网站。
- 使用Cloud Functions或Cloud Run来处理API请求，后端逻辑与Firestore数据库交互。

---

## 第3部分：$300试用金的“刀刃”用法

这$300是你的“体验券”，应该用来尝试那些你平时因为价格而犹豫的服务。

**高价值实验清单**:

1.  **体验高性能虚拟机**
    - **做什么**: 启动一台配置强大的`n2`或`c2`系列虚拟机（例如8核CPU, 32GB内存），在上面编译大型开源项目（如Android源码），感受云端高性能计算的威力。
    - **注意**: 这种虚拟机每小时费用可能高达数美元，体验几小时后务必**立即删除**。

2.  **部署一个生产级Kubernetes集群 (GKE)**
    - **做什么**: 使用Google Kubernetes Engine (GKE) 创建一个包含3-5个节点的标准集群。在上面部署一个带有负载均衡、自动伸缩的微服务应用。
    - **价值**: GKE是GCP的王牌服务之一。通过实践，你可以深入理解Kubernetes的声明式API、服务发现、滚动更新等核心概念。
    - **示例命令**:
      ```bash
      # 创建一个3节点的标准集群 (这将消耗你的试用金)
      gcloud container clusters create my-gke-cluster --num-nodes=3 --zone=us-central1-a
      ```

3.  **玩转大数据与分析 (BigQuery)**
    - **做什么**: 找一个公开的大型数据集（如GitHub Archive），上传到BigQuery中，然后练习编写复杂的分析查询语句。
    - **价值**: BigQuery是Google的另一大杀器，能让你在数秒内处理TB级的数据。这是在本地计算机上无法获得的体验。

4.  **探索AI与机器学习API**
    - **做什么**: 调用Vision AI API来识别图片内容，使用Natural Language AI API分析文本情感，或者用AutoML训练一个自定义的图像分类模型。
    - **价值**: 让你直观地感受到AI-as-a-Service的强大，并思考如何将其集成到你的应用中。
    - **示例 (Python)**:
      ```python
      from google.cloud import vision
      client = vision.ImageAnnotatorClient()
      # ... 调用API进行标签检测 ...
      ```

5.  **使用托管数据库 (Cloud SQL)**
    - **做什么**: 创建一个高可用的Cloud SQL for PostgreSQL实例，并将其与你的应用连接。测试其备份、恢复和只读副本功能。
    - **价值**: 理解托管数据库相比于在VM上自建数据库的优势（易于管理、高可用、自动备份）。

---

## 第4部分：成本控制：从根源杜绝“账单惊喜”

这是本教程最关键的部分。自由探索的前提是可控的成本。

### 4.1 设置预算和告警

1.  在GCP控制台，导航到`结算` -> `预算和提醒`。
2.  点击`创建预算`。
3.  **范围**: 选择你的结算账号。
4.  **金额**: 目标金额设置为`$290`（略低于$300，给自己留一些缓冲）。
5.  **操作**: 这是最关键的一步。设置**提醒阈值**：
    - 在费用的`50%`时，发送电子邮件通知。
    - 在费用的`90%`时，发送电子邮件通知。
    - 在费用的`100%`时，发送电子邮件通知。
6.  **（可选，高级）连接到Pub/Sub主题**: 你可以设置当预算达到某个阈值时，向一个Pub/Sub主题发送消息。这可以用来触发自动化的“停机”脚本。

### 4.2 终极武器：基于预算的自动停机脚本

通过将预算提醒与Cloud Functions结合，你可以创建一个“财务熔断”机制。

**工作流程**:
`预算达到阈值` -> `发送消息到Pub/Sub主题` -> `触发Cloud Function` -> `该Function调用Billing API禁用当前项目的所有服务`

**Cloud Function示例 (Node.js)**:
```javascript
const {CloudBillingClient} = require('@google-cloud/billing');
const {ProjectsClient} = require('@google-cloud/resource-manager');

const billingClient = new CloudBillingClient();
const projectsClient = new ProjectsClient();

exports.stopBilling = async (pubsubMessage) => {
  const pubsubData = JSON.parse(Buffer.from(pubsubMessage.data, 'base64').toString());
  const budget = pubsubData.budgetDisplayName;
  const cost = pubsubData.costAmount;
  const threshold = pubsubData.alertThresholdExceeded;

  console.log(`Budget '${budget}' cost ${cost} exceeded threshold ${threshold}`);

  const PROJECT_ID = process.env.GCP_PROJECT;
  if (!PROJECT_ID) {
    throw new Error('GCP_PROJECT environment variable not set.');
  }

  const [project] = await projectsClient.getProject({name: `projects/${PROJECT_ID}`});
  const billingInfo = await billingClient.getProjectBillingInfo({name: project.name});

  if (billingInfo[0].billingEnabled) {
    console.log(`Disabling billing for project ${PROJECT_ID}...`);
    await billingClient.updateProjectBillingInfo({
      name: project.name,
      projectBillingInfo: { billingAccountName: '' }, // Disassociates the project from its billing account
    });
    console.log(`Billing disabled for project ${PROJECT_ID}.`);
  } else {
    console.log(`Billing already disabled for project ${PROJECT_ID}.`);
  }
};
```
将此函数部署后，当你的花费超过预设，它会自动“拔掉”你项目的电源，提供终极保护。

### 4.3 定期检查残留资源

- **外部IP地址**: 未使用的静态IP地址会收费。
- **永久性磁盘**: 删除了VM但忘记删除其关联的磁盘。
- **负载均衡器**: 创建了但未使用的转发规则。

使用`gcloud`命令定期巡检：
```bash
gcloud compute addresses list
gcloud compute disks list
gcloud compute forwarding-rules list
```

---

## 第5部分：90天后的策略：无缝过渡到“永久免费”

在试用期结束前一周，开始进行“降级”操作。

**迁移清单**:
1.  [ ] **删除所有非免费资源**: 这是最重要的一步。删除所有GKE集群、Cloud SQL实例、高性能VM等。
2.  [ ] **迁移核心应用**: 如果你有长期运行的应用（如博客），确保它运行在`e2-micro`实例上，并且该实例位于指定的美国区域内。
3.  [ ] **检查存储用量**: 确保你的Cloud Storage用量在5GB以下。
4.  [ ] **检查数据库**: 如果你使用了Cloud SQL，考虑将其数据迁移到VM上自建的PostgreSQL/MySQL/SQLite数据库中，或者迁移到Firestore的免费套餐内。
5.  [ ] **释放静态IP**: 将服务域名指向`e2-micro`实例的临时IP，或者接受静态IP的少量费用（每月约$3-$4）。

完成以上步骤后，即使$300额度用尽或90天到期，你的账单也应该为$0。

## 结论

GCP的免费套餐是开发者的一座金矿。其成功的关键策略在于：**分离“长期持有”和“短期体验”**。用“始终免费”层级来保障你个人项目7x24小时的低成本运行，用$300试用金这艘“体验航母”去探索云计算的星辰大海。同时，永远不要忘记设置好你的“财务安全带”——预算和告警。现在，开始你的云端探索之旅吧！

## 参考资料
- [Google Cloud 免费层级官方文档](https://cloud.google.com/free/docs/gcp-free-tier)
- [Google Cloud 定价计算器](https://cloud.google.com/products/calculator)
- [通过程序化方式关闭结算的教程](https://cloud.google.com/billing/docs/how-to/programmatic-disable-billing)
