# 05.5 è‡ªåŠ¨å‘å¸ƒè„šæœ¬ï¼šä¸€é”®å°†MarkdownåŒæ­¥åˆ°å¤šä¸ªå¹³å°

> ä½ åˆšåˆšåœ¨Obsidianæˆ–VS Codeä¸­å®Œæˆäº†ä¸€ç¯‡ç²¾å½©çš„æŠ€æœ¯æ–‡ç« ï¼Œç°åœ¨ï¼Œå™©æ¢¦å¼€å§‹äº†ï¼šä½ éœ€è¦æ‰‹åŠ¨ç™»å½•DEV.to, Medium, Hashnode, æ˜é‡‘, CSDNç­‰å¤šä¸ªå¹³å°ï¼Œé€ä¸€è¿›è¡Œå¤åˆ¶ã€ç²˜è´´ã€è°ƒæ•´æ ¼å¼ã€ä¸Šä¼ å›¾ç‰‡â€¦â€¦è¿™ä¸ªè¿‡ç¨‹ä¸ä»…æ¯ç‡¥ã€è€—æ—¶ã€æ˜“å‡ºé”™ï¼Œæ›´æ˜¯æ‰¼æ€åˆ›ä½œçƒ­æƒ…çš„â€œå¤´å·æ€æ‰‹â€ã€‚æœ¬ç¯‡æ•™ç¨‹å°†ä¸ºä½ æä¾›ä¸€å¥—ç»ˆæè§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ç¼–å†™ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„Node.jsè„šæœ¬ï¼Œå®ç°â€œä¸€é”®å‘å¸ƒâ€ï¼Œå°†ä½ çš„Markdownæ–‡ç« åŒæ­¥åˆ°æµ·å†…å¤–å¤šä¸ªä¸»æµæŠ€æœ¯å¹³å°ï¼Œè®©ä½ ä»é‡å¤çš„ä½“åŠ›åŠ³åŠ¨ä¸­å½»åº•è§£æ”¾å‡ºæ¥ã€‚

**å­¦ä¹ ç›®æ ‡**:
- ç†è§£è·¨å¹³å°å‘å¸ƒçš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯å›¾ç‰‡å¤„ç†å’Œå¹³å°APIå·®å¼‚ã€‚
- æŒæ¡å¦‚ä½•è·å–å¹¶ç®¡ç†å¤šä¸ªå¹³å°çš„APIå¯†é’¥ã€‚
- å­¦ä¼šä½¿ç”¨Node.jsç¼–å†™ä¸€ä¸ªé¢„å¤„ç†è„šæœ¬ï¼Œè‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡åˆ°å›¾åºŠå¹¶æ›¿æ¢é“¾æ¥ã€‚
- æŒæ¡å¦‚ä½•é€šè¿‡æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚`crosspost`ï¼‰æ¥å‘å¸ƒåˆ°æ”¯æŒAPIçš„å¹³å°ã€‚
- äº†è§£å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·Puppeteerï¼Œæå®šé‚£äº›æ²¡æœ‰æä¾›å…¬å…±APIçš„å¹³å°ï¼ˆå¦‚æ˜é‡‘ã€CSDNï¼‰ã€‚

---

## ç¬¬1éƒ¨åˆ†ï¼šè·¨å¹³å°å‘å¸ƒçš„æŒ‘æˆ˜

1.  **APIå·®å¼‚**: æ¯ä¸ªå¹³å°éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„APIï¼Œè¯·æ±‚æ ¼å¼ã€è®¤è¯æ–¹å¼å„ä¸ç›¸åŒã€‚
2.  **å›¾ç‰‡å¤„ç†**: è¿™æ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚ä½ æ–‡ç« ä¸­çš„æœ¬åœ°å›¾ç‰‡é“¾æ¥ï¼ˆ`./images/a.png`ï¼‰åœ¨å…¶ä»–å¹³å°ä¸Šæ˜¯æ— æ•ˆçš„ã€‚ä½ éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„ã€å…¬å¼€å¯è®¿é—®çš„å›¾åºŠï¼Œå¹¶åœ¨å‘å¸ƒå‰å°†æ‰€æœ‰æœ¬åœ°å›¾ç‰‡é“¾æ¥æ›¿æ¢ä¸ºå›¾åºŠURLã€‚
3.  **Canonical URL**: ä¸ºäº†SEOï¼Œä½ å¿…é¡»åœ¨æ‰€æœ‰è½¬è½½çš„å¹³å°ä¸Šï¼Œæ­£ç¡®è®¾ç½®`canonical_url`ï¼ŒæŒ‡å‘ä½ ä¸ªäººåšå®¢ä¸Šçš„åŸæ–‡é“¾æ¥ï¼Œä»¥é¿å…æœç´¢å¼•æ“çš„â€œé‡å¤å†…å®¹â€æƒ©ç½šã€‚
4.  **Markdownæ–¹è¨€**: å„ä¸ªå¹³å°å¯¹Markdownçš„æ¸²æŸ“æ”¯æŒæœ‰ç»†å¾®å·®åˆ«ï¼Œå¯èƒ½éœ€è¦å¾®è°ƒã€‚

æˆ‘ä»¬çš„ç­–ç•¥æ˜¯ï¼š**æ„å»ºä¸€ä¸ªNode.jsä¸»è„šæœ¬ï¼Œå®ƒè´Ÿè´£é¢„å¤„ç†Markdownï¼ˆç‰¹åˆ«æ˜¯å›¾ç‰‡ï¼‰ï¼Œç„¶åè°ƒç”¨ä¸åŒçš„â€œå‘å¸ƒæ¨¡å—â€æ¥é€‚é…å„ä¸ªå¹³å°ã€‚**

---

## ç¬¬2éƒ¨åˆ†ï¼šå‡†å¤‡å·¥ä½œï¼šAPIå¯†é’¥ä¸é…ç½®æ–‡ä»¶

### 2.1 è·å–APIå¯†é’¥

- **DEV.to**: `Settings` -> `Account` -> `DEV Community API Keys`ã€‚
- **Hashnode**: `Settings` -> `Developer` -> `Generate New Token`ã€‚
- **Medium**: `Settings` -> `Integration tokens`ã€‚
- **æ˜é‡‘ / CSDN**: è¿™ä¸¤ä¸ªå¹³å°æ²¡æœ‰æä¾›å®˜æ–¹çš„å…¬å…±å‘å¸ƒAPIã€‚æˆ‘ä»¬å°†é‡‡ç”¨**æµè§ˆå™¨è‡ªåŠ¨åŒ–**æ–¹æ¡ˆï¼Œé€šè¿‡**Cookies**æ¥ç»´æŒç™»å½•çŠ¶æ€ã€‚
- **Cloudinary (æˆ‘ä»¬çš„å›¾åºŠ)**: æ³¨å†Œ[Cloudinary](https://cloudinary.com/)ï¼Œåœ¨Dashboardä¸­å¯ä»¥æ‰¾åˆ°ä½ çš„`Cloud Name`, `API Key`, `API Secret`ã€‚

### 2.2 åˆ›å»ºé…ç½®æ–‡ä»¶ (`config.js`)

åˆ›å»ºä¸€ä¸ª`config.js`æ–‡ä»¶æ¥é›†ä¸­ç®¡ç†æ‰€æœ‰å¯†é’¥ã€‚**è­¦å‘Šï¼šå¿…é¡»å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°`.gitignore`ä¸­ï¼Œç»å¯¹ä¸è¦æäº¤åˆ°Gitä»“åº“ï¼**

```javascript
// config.js
// ï¼ï¼ï¼NEVER COMMIT THIS FILE TO GITï¼ï¼ï¼

module.exports = {
  // ä¸ªäººåšå®¢ä¿¡æ¯ï¼Œç”¨äºç”ŸæˆCanonical URL
  blog: {
    url: "https://your-awesome-blog.com",
    author: "Your Name",
  },

  // å¹³å°APIå¯†é’¥
  platforms: {
    devto: {
      apiKey: "YOUR_DEVTO_API_KEY",
    },
    hashnode: {
      apiKey: "YOUR_HASHNODE_API_KEY",
      publicationId: "YOUR_HASHNODE_PUBLICATION_ID", // åœ¨åå°å¯ä»¥æ‰¾åˆ°
    },
    medium: {
      apiKey: "YOUR_MEDIUM_API_KEY",
      authorId: "YOUR_MEDIUM_AUTHOR_ID", // åœ¨åå°å¯ä»¥æ‰¾åˆ°
    },
  },

  // å›¾åºŠé…ç½®
  cloudinary: {
    cloud_name: "YOUR_CLOUDINARY_CLOUD_NAME",
    api_key: "YOUR_CLOUDINARY_API_KEY",
    api_secret: "YOUR_CLOUDINARY_API_SECRET",
  },

  // æµè§ˆå™¨è‡ªåŠ¨åŒ–é…ç½® (è·å–æ–¹å¼è§åæ–‡)
  browser: {
    juejin: {
      cookie: "YOUR_JUEJIN_COOKIE_STRING",
    },
    csdn: {
      cookie: "YOUR_CSDN_COOKIE_STRING",
    },
  },
};
```

---

## ç¬¬3éƒ¨åˆ†ï¼šæ ¸å¿ƒè„šæœ¬1ï¼šMarkdowné¢„å¤„ç†ä¸å›¾ç‰‡ä¸Šä¼ 

è¿™ä¸ªè„šæœ¬è´Ÿè´£å°†ä¸€ç¯‡æœ¬åœ°Markdownæ–‡ç« ï¼Œè½¬æ¢æˆé€‚åˆå…¬å¼€å‘å¸ƒçš„ã€å›¾ç‰‡é“¾æ¥å·²å…¨éƒ¨æ›¿æ¢çš„â€œå¹²å‡€â€ç‰ˆæœ¬ã€‚

**å®‰è£…ä¾èµ–**: `npm install gray-matter cloudinary glob fs-extra`

```javascript
// preprocess.js
const fs = require(\'fs-extra\');
const path = require(\'path\');
const matter = require(\'gray-matter\');
const cloudinary = require(\'cloudinary\').v2;
const config = require(\'./config\');

// é…ç½®Cloudinary
cloudinary.config(config.cloudinary);

// ä¸Šä¼ å›¾ç‰‡åˆ°Cloudinaryå¹¶è¿”å›URL
async function uploadImage(filePath) {
  try {
    const result = await cloudinary.uploader.upload(filePath, {
      folder: \'blog_assets\', // åœ¨Cloudinaryä¸ŠæŒ‡å®šçš„æ–‡ä»¶å¤¹
    });
    return result.secure_url;
  } catch (error) {
    console.error(\'Error uploading image:\', error);
    return null;
  }
}

// ä¸»å¤„ç†å‡½æ•°
async function preprocessMarkdown(filePath) {
  const markdown = await fs.readFile(filePath, \'utf-8\');
  const { data: frontmatter, content } = matter(markdown);
  let newContent = content;

  // 1. è‡ªåŠ¨è®¾ç½®Canonical URL
  const slug = path.basename(filePath, \'.md\');
  frontmatter.canonical_url = `${config.blog.url}/posts/${slug}`;

  // 2. æŸ¥æ‰¾å¹¶æ›¿æ¢æ‰€æœ‰æœ¬åœ°å›¾ç‰‡é“¾æ¥
  const imageRegex = /!\\[(.*?)\]\\[\(.*?)\]/g;
  const imagePromises = [];
  let match;

  while ((match = imageRegex.exec(content)) !== null) {
    const [fullMatch, altText, localPath] = match;
    const absolutePath = path.resolve(path.dirname(filePath), localPath);

    if (fs.existsSync(absolutePath)) {
      console.log(`Uploading image: ${localPath}`);
      const promise = uploadImage(absolutePath).then(url => {
        if (url) {
          console.log(`  -> Uploaded to: ${url}`);
          // å°†æ–‡ç« å†…å®¹ä¸­çš„æœ¬åœ°è·¯å¾„æ›¿æ¢ä¸ºäº‘ç«¯URL
          newContent = newContent.replace(localPath, url);
        }
      });
      imagePromises.push(promise);
    }
  }

  await Promise.all(imagePromises);

  // 3. è¿”å›åŒ…å«æ›´æ–°åFrontmatterå’Œå†…å®¹çš„æ–°Markdownå­—ç¬¦ä¸²
  return matter.stringify(newContent, frontmatter);
}

module.exports = { preprocessMarkdown };
```

---

## ç¬¬4éƒ¨åˆ†ï¼šæ ¸å¿ƒè„šæœ¬2ï¼šå‘å¸ƒåˆ°å„å¤§å¹³å°

è¿™ä¸ªä¸»è„šæœ¬å°†è°ƒç”¨é¢„å¤„ç†è„šæœ¬ï¼Œç„¶ååˆ†åˆ«è°ƒç”¨å„ä¸ªå¹³å°çš„å‘å¸ƒé€»è¾‘ã€‚

### 4.1 å‘å¸ƒåˆ°æ”¯æŒAPIçš„å¹³å° (DEV.to, Hashnode, Medium)

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç°æˆçš„ã€å¼ºå¤§çš„CLIå·¥å…·`crosspost`æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚

**å®‰è£…ä¾èµ–**: `npm install node-fetch` (ç”¨äºHashnode GQL API)

```javascript
// publishers/apiPlatforms.js
const { execSync } = require(\'child_process\');
const fetch = require(\'node-fetch\');
const config = require(\'../config\');

// ä½¿ç”¨crosspost CLIå‘å¸ƒåˆ°DEV.to
async function publishToDevto(markdownContent) {
  console.log(\'\nPublishing to DEV.to...\');
  try {
    // crosspostéœ€è¦æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸´æ—¶å†™å…¥ä¸€ä¸ªæ–‡ä»¶
    fs.writeFileSync(\'temp_article.md\', markdownContent);
    execSync(`npx crosspost temp_article.md --platforms devto --devtoKey ${config.platforms.devto.apiKey}`,
      { stdio: \'inherit\' });
    console.log(\'âœ… Published to DEV.to successfully.\');
  } catch (error) {
    console.error(\'âŒ Failed to publish to DEV.to:\', error.message);
  }
}

// ä½¿ç”¨Hashnode GraphQL APIå‘å¸ƒ
async function publishToHashnode(markdownContent, frontmatter) {
  console.log(\'\nPublishing to Hashnode...\');
  const mutation = `
    mutation CreatePublicationStory {
      createPublicationStory(publicationId: \"${config.platforms.hashnode.publicationId}\", input: {
        title: \"${frontmatter.title}\",
        contentMarkdown: \"${markdownContent.replace(/"/g, \'\\\"')}\",
        tags: [],
        slug: \"${frontmatter.slug}\",
        isRepublished: { originalArticleURL: \"${frontmatter.canonical_url}\" }
      }) { success, message }
    }
  `;
  try {
    const response = await fetch(\'https://api.hashnode.com\', {
      method: \'POST\',
      headers: { \'Content-Type\': \'application/json\', \'Authorization\': config.platforms.hashnode.apiKey },
      body: JSON.stringify({ query: mutation }),
    });
    const result = await response.json();
    if (result.data.createPublicationStory.success) {
      console.log(\'âœ… Published to Hashnode successfully.\');
    } else {
      throw new Error(result.data.createPublicationStory.message);
    }
  } catch (error) {
    console.error(\'âŒ Failed to publish to Hashnode:\', error.message);
  }
}

// ... ç±»ä¼¼åœ°ï¼Œå¯ä»¥ä¸ºMediumç¼–å†™å‘å¸ƒå‡½æ•° ...

module.exports = { publishToDevto, publishToHashnode };
```

### 4.2 å‘å¸ƒåˆ°æ— APIçš„å¹³å° (æ˜é‡‘, CSDN)

æˆ‘ä»¬å°†ä½¿ç”¨`Puppeteer`ï¼Œä¸€ä¸ªNode.jsåº“ï¼Œå®ƒèƒ½ä»¥ç¼–ç¨‹æ–¹å¼æ§åˆ¶ä¸€ä¸ªçœŸå®çš„Chromeæµè§ˆå™¨ã€‚

**å®‰è£…ä¾èµ–**: `npm install puppeteer`

```javascript
// publishers/browserPlatforms.js
const puppeteer = require(\'puppeteer\');
const config = require(\'../config\');

// è·å–Cookieçš„è¯´æ˜ï¼š
// 1. åœ¨Chromeä¸­ç™»å½•æ˜é‡‘/CSDNã€‚
// 2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œè¿›å…¥"ç½‘ç»œ(Network)"æ ‡ç­¾é¡µã€‚
// 3. åˆ·æ–°é¡µé¢ï¼Œæ‰¾åˆ°ä»»æ„ä¸€ä¸ªå¯¹ä¸»ç«™å‘èµ·çš„è¯·æ±‚ï¼ˆå¦‚`juejin.cn`ï¼‰ã€‚
// 4. åœ¨è¯·æ±‚å¤´(Request Headers)ä¸­ï¼Œæ‰¾åˆ°`cookie:`è¡Œï¼Œå¤åˆ¶å…¶å®Œæ•´çš„å­—ç¬¦ä¸²å€¼ã€‚

async function publishToJuejin(title, markdownContent) {
  console.log(\'\nPublishing to Juejin...\');
  const browser = await puppeteer.launch({ headless: false }); // headless:falseå¯ä»¥åœ¨è°ƒè¯•æ—¶çœ‹åˆ°æµè§ˆå™¨ç•Œé¢
  const page = await browser.newPage();

  try {
    // 1. æ³¨å…¥Cookieï¼Œå®ç°å…ç™»å½•
    const cookies = config.browser.juejin.cookie.split(\' ; \').map(pair => {
      const [name, ...value] = pair.split(\'=\');
      return { name, value: value.join(\'=\'), domain: \'.juejin.cn\' };
    });
    await page.setCookie(...cookies);

    // 2. æ‰“å¼€åˆ›ä½œé¡µé¢
    await page.goto(\'https://juejin.cn/editor/drafts/new\', { waitUntil: \'networkidle2\' });

    // 3. å¡«å……å†…å®¹
    await page.type(\' .title-input\', title);
    await page.click(\' .bytemd-tippy-right > .bytemd-toolbar-icon:first-child\'); // åˆ‡æ¢åˆ°Markdownç¼–è¾‘å™¨
    await page.evaluate((content) => {
      const editor = document.querySelector(\' .bytemd-editor .CodeMirror\').CodeMirror;
      editor.setValue(content);
    }, markdownContent);

    // 4. ç‚¹å‡»å‘å¸ƒæŒ‰é’® (æ­¤å¤„é€‰æ‹©å™¨å¯èƒ½éœ€è¦æ ¹æ®å®é™…é¡µé¢æ›´æ–°)
    await page.click(\' .publish-btn\');
    console.log(\'âœ… Published to Juejin successfully (check browser for final confirmation).\');

  } catch (error) {
    console.error(\'âŒ Failed to publish to Juejin:\', error.message);
  } finally {
    await browser.close();
  }
}

module.exports = { publishToJuejin };
```

---

## ç¬¬5éƒ¨åˆ†ï¼šæ•´åˆä¸æ‰§è¡Œ

æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸»å…¥å£æ–‡ä»¶`publish.js`ã€‚

```javascript
// publish.js
const { preprocessMarkdown } = require(\'./preprocess\');
const { publishToDevto, publishToHashnode } = require(\'./publishers/apiPlatforms\');
const { publishToJuejin } = require(\'./publishers/browserPlatforms\');
const matter = require(\'gray-matter\');

async function main() {
  const filePath = process.argv[2];
  if (!filePath) {
    console.error(\'âŒ Please provide the path to your markdown file.\');
    console.log(\'Usage: node publish.js <path-to-article.md>\');
    return;
  }

  console.log(\'ğŸš€ Starting cross-posting process...\');

  // 1. é¢„å¤„ç†Markdown
  const processedMarkdown = await preprocessMarkdown(filePath);
  const { data: frontmatter, content } = matter(processedMarkdown);

  // 2. ä¾æ¬¡å‘å¸ƒåˆ°å„ä¸ªå¹³å°
  await publishToDevto(processedMarkdown);
  await publishToHashnode(content, frontmatter);
  await publishToJuejin(frontmatter.title, content);
  // ... è°ƒç”¨å‘å¸ƒåˆ°CSDNå’Œå…¶ä»–å¹³å°çš„å‡½æ•° ...

  console.log(\'\nâœ¨ All publishing tasks are complete!\');
}

main();
```

**æœ€ç»ˆæ‰§è¡Œ**: 
ç°åœ¨ï¼Œä½ åªéœ€è¦åœ¨ç»ˆç«¯è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½å¯åŠ¨æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹ï¼š
```bash
node publish.js /path/to/your/awesome-article.md
```

## ç»“è®º

è‡ªåŠ¨åŒ–è·¨å¹³å°å‘å¸ƒæ˜¯ä¸€ä¸ªå¤æ‚ä½†å›æŠ¥ç‡æé«˜çš„å·¥ç¨‹ã€‚é€šè¿‡å°†æµç¨‹æ‹†è§£ä¸ºâ€œé¢„å¤„ç†â€å’Œâ€œå‘å¸ƒâ€ä¸¤å¤§ç¯èŠ‚ï¼Œå¹¶é’ˆå¯¹ä¸åŒå¹³å°çš„ç‰¹æ€§ï¼Œçµæ´»é‡‡ç”¨APIæˆ–æµè§ˆå™¨è‡ªåŠ¨åŒ–ç­‰ä¸åŒç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå¼ºå¤§çš„ã€å±äºè‡ªå·±çš„å†…å®¹åˆ†å‘å¼•æ“(CDE)ã€‚æŠ•èµ„æ—¶é—´æ‰“ç£¨è¿™æ ·ä¸€å¥—è„šæœ¬ï¼Œæ„å‘³ç€ä½ å°†ä»ç¹ççš„é‡å¤åŠ³åŠ¨ä¸­æ°¸ä¹…è§£æ”¾å‡ºæ¥ï¼Œä»è€Œèƒ½æ›´ä¸“æ³¨äºå†…å®¹åˆ›ä½œæœ¬èº«â€”â€”è¿™æ‰æ˜¯ä½ ä½œä¸ºåˆ›ä½œè€…æœ€æ ¸å¿ƒçš„ä»·å€¼æ‰€åœ¨ã€‚

## å‚è€ƒèµ„æ–™
- [crosspost-cli (å¤šå¹³å°å‘å¸ƒCLI)](https://github.com/sinedied/crosspost-cli)
- [Puppeteer (æµè§ˆå™¨è‡ªåŠ¨åŒ–)](https://pptr.dev/)
- [Cloudinary Node.js SDK](https://cloudinary.com/documentation/node_integration)
- [gray-matter (Frontmatterè§£æåº“)](https://github.com/jonschlinkert/gray-matter)
